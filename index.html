<!-- Tabirly • Numeroloji / Numerology — v4.7  (Dual-language, fixed Info tab, fixed labels, full long texts, master numbers in summary) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{
  --p1:#E87C6D; --p2:#EBA76D; --p3:#E8926D; --p4:#E86D82; --p5:#E8BA6D; --p6:#F0A88D;
  --page:#FFF9F6; --panel:#FFF6F1; --card:#FFFCFA; --card-alt:#FFF7F3; --border:#F2D5C9;
  --txt:#111213; --muted:#4A4F57;
  --acc1:var(--p3); --acc2:var(--p4);
  --rad:16px; --pad:clamp(14px,2vw,18px); --w:1080px;
}
*{box-sizing:border-box}
.tb{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--txt)}
.wrap{
  max-width:var(--w);margin:0 auto;
  background:linear-gradient(135deg,
      color-mix(in srgb, var(--p6) 22%, white) 0%,
      color-mix(in srgb, var(--p2) 18%, white) 35%,
      color-mix(in srgb, var(--p3) 18%, white) 70%,
      color-mix(in srgb, var(--p4) 22%, white) 100%
    ) padding-box,var(--panel) border-box;
  border:1px solid var(--border);border-radius:var(--rad);padding:var(--pad);
  box-shadow:0 10px 40px rgba(232,140,130,.20)
}
.head{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px}
.head h2{font-family:"Space Grotesk";margin:0;font-size:clamp(22px,3vw,30px);color:#0c0d0f}
.head .lang{display:flex;gap:8px;align-items:center}
.head select{background:#fff;border:1px solid var(--border);border-radius:12px;padding:8px 10px}

.sub{color:var(--muted);margin-bottom:10px;font-size:.95rem}
.tabs{display:flex;gap:8px;margin:10px 0 14px;flex-wrap:wrap}
.tab-btn{border:1px solid var(--border);background:linear-gradient(180deg,#FFF,var(--card));color:var(--txt);padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:700}
.tab-btn.active{background:linear-gradient(135deg,var(--acc1),var(--acc2));color:#111;border-color:transparent;box-shadow:0 2px 10px rgba(232,140,130,.35)}
.panel{display:none;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px}
.panel.active{display:block}
.results{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px}
.card h3{font-family:"Space Grotesk";margin:0 0 6px;font-size:1.05rem;color:#0b0c0f}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
label{font-size:.9rem;color:var(--muted)}
input,select,textarea{width:100%;background:#FFF;color:var(--txt);border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:1rem;outline:none}
input::placeholder,textarea::placeholder{color:#7b818b}
input:focus,select:focus,textarea:focus{border-color:color-mix(in srgb,var(--acc1) 55%,white);box-shadow:0 0 0 3px color-mix(in srgb,var(--acc1) 25%,white)}
.hint{display:block;font-size:.78rem;color:#6b717a;margin-top:6px}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 6px}
button{background:linear-gradient(135deg,var(--acc1),var(--acc2));border:none;color:#111;font-weight:800;padding:10px 14px;border-radius:14px;cursor:pointer}
button:hover{filter:saturate(1.05) brightness(1.02)}
button.sec{background:linear-gradient(180deg,#FFF,var(--card-alt));color:var(--txt);border:1px solid var(--border)}
.k{display:inline-block;min-width:28px;height:28px;line-height:28px;text-align:center;border-radius:8px;background:color-mix(in srgb,var(--p1) 12%, white);border:1px solid var(--border);font-weight:800;margin-right:8px;color:#161616}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:.78rem;color:#2d3138;background:#fff}
.row-inline{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:4px 0}
.muted{font-size:.92rem;color:#4A4F57}
.long{font-size:.95rem;line-height:1.6;color:#141517}
details{background:var(--card-alt);border:1px dashed var(--border);border-radius:12px;padding:10px;margin:8px 0}
summary{cursor:pointer;font-weight:700;color:#141517}
.chald-note{margin-top:8px;padding:10px 12px;border-radius:12px;background:color-mix(in srgb,var(--p4) 16%,white);border:1px dashed color-mix(in srgb,var(--p4) 45%,white);color:#111}
.timebar{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.timeItem{flex:1 1 220px;background:color-mix(in srgb,var(--p5) 12%,white);border:1px solid var(--border);border-radius:12px;padding:10px;color:#111}
.timeItem b{display:block;color:#0f1112}
.pill{display:inline-block;padding:4px 10px;border:1px solid var(--border);border-radius:999px;margin:2px;font-size:.8rem;color:#2a2e34;background:#fff}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.foot{margin-top:10px;font-size:.86rem;color:#muted}
.card .mini{margin-top:6px;font-size:.9rem;line-height:1.35;color:#2b3138}
.tip{border-bottom:1px dashed rgba(0,0,0,.35);cursor:help}
.timeItem .mini{margin-top:6px;font-size:.9rem;color:#2b3138;line-height:1.35}
.time-legend{margin-top:8px;font-size:.9rem;color:#4A4F57}
@media (max-width:760px){.grid,.results,.two{grid-template-columns:1fr}}
@media print{body{background:#fff}.tabs,.btns,.head .lang{display:none}}
@media (max-width:760px){
  .btns{flex-direction: column;align-items: stretch}
  .btns button, .btns .sec{width: 100%;text-align: center}
}
</style>

<div class="tb">
  <div class="wrap">
    <div class="head">
      <h2 data-i18n="title">Tabirly • Numeroloji Falı</h2>
      <div class="lang">
        <label for="langSel" data-i18n="langLabel">Dil</label>
        <select id="langSel"><option value="tr">Türkçe</option><option value="en">English</option></select>
      </div>
    </div>

    <div class="sub" data-i18n-html="tagline">Pythagoras ↔ Chaldean, Akıllı Özet…</div>
    <div class="sub" data-i18n-html="note">Yoğun görünebilir…</div>

    <div class="tabs" role="tablist" aria-label="sections">
      <button class="tab-btn active" data-tab="tek" role="tab" aria-controls="panel-tek" aria-selected="true" data-i18n="tabSingle">Tek Kişi</button>
      <button class="tab-btn" data-tab="uyum" role="tab" aria-controls="panel-uyum" aria-selected="false" data-i18n="tabCompat">Uyumluluk (2 Kişi)</button>
      <button class="tab-btn" data-tab="bilgi" role="tab" aria-controls="panel-bilgi" aria-selected="false" data-i18n="tabInfo">Bilgi</button>
    </div>

    <!-- TEK KİŞİ -->
    <div class="panel active" id="panel-tek" role="tabpanel">
      <div class="grid">
        <div><label for="name" data-i18n="nameLbl">Tam İsim (resmi)</label><input id="name" type="text" data-i18n-ph="namePH"/></div>
        <div>
          <label for="dob" data-i18n="dobLbl">Doğum Tarihi</label>
          <input id="dob" type="date"/>
          <small class="hint" data-i18n="dobHint">Biçim: gg/aa/yyyy</small>
        </div>
        <div>
          <label for="refdate" data-i18n="refLbl">Kişisel Yıl/Ay/Gün Referans Tarihi</label>
          <input id="refdate" type="date"/>
          <small class="hint" data-i18n="refHint">Biçim: gg/aa/yyyy</small>
        </div>
        <div><label for="sys" data-i18n="sysLbl">Sistem</label>
          <select id="sys">
            <option value="pyth" data-i18n="sysP">Pythagoras (Modern)</option>
            <option value="chald" data-i18n="sysC">Chaldean (Babil)</option>
          </select>
        </div>
      </div>
      <div class="btns">
        <button id="calc"><span data-i18n="calcBtn">Hesapla</span></button>
        <button class="sec" id="copy"><span data-i18n="copyBtn">Kopyala</span></button>
        <button class="sec" id="print"><span data-i18n="printBtn">Yazdır / PDF</span></button>
        <span class="muted" style="font-size:x-small;" data-i18n="chald9">Chaldean’da 9…</span>
      </div>

      <div class="card"><h3 data-i18n="smartTitle">Akıllı Özet</h3><div class="long muted" id="smart-summary" data-i18n="smartDefault">Sonuçları hesapla…</div></div>

      <div class="card"><h3><span data-i18n="coreTitle">Çekirdek Sayılar</span> <span class="badge" id="sys-badge"></span></h3><div class="results" id="core-grid"></div></div>

      <div class="two">
        <div class="card"><h3 data-i18n="supportTitle">Destekleyici Sayılar</h3><div class="results" id="support-grid"></div></div>
        <div class="card"><h3 data-i18n="cyclesTitle">Zaman Döngüleri</h3><div class="results" id="cycle-grid"></div></div>
      </div>

      <div class="card"><h3 data-i18n="timelineTitle">Zirve ve Mücadele Dönemleri (Pinnacle &amp; Challenge Timeline)</h3><div id="timeline"></div></div>

      <div class="card"><h3 data-i18n="longTextsTitle">Uzun Yorumlar (Sayıya Özgü)</h3><p class="muted" data-i18n="chaldHint">Chaldean seçiliyken…</p><div id="long-texts"></div></div>

      <div class="foot">© Tabirly</div>
    </div>

    <!-- UYUMLULUK -->
    <div class="panel" id="panel-uyum" role="tabpanel">
      <div class="grid">
        <div><label for="nameA" data-i18n="aNameLbl">İsim A</label><input id="nameA" type="text" data-i18n-ph="nameAPH"/></div>
        <div><label for="dobA" data-i18n="aDobLbl">Doğum A</label><input id="dobA" type="date"/><small class="hint" data-i18n="aDobHint">Biçim: gg/aa/yyyy</small></div>
        <div><label for="nameB" data-i18n="bNameLbl">İsim B</label><input id="nameB" type="text" data-i18n-ph="nameBPH"/></div>
        <div><label for="dobB" data-i18n="bDobLbl">Doğum B</label><input id="dobB" type="date"/><small class="hint" data-i18n="bDobHint">Biçim: gg/aa/yyyy</small></div>
        <div><label for="sys2" data-i18n="sysLbl2">Sistem</label>
          <select id="sys2">
            <option value="pyth" data-i18n="sysP2">Pythagoras (Modern)</option>
            <option value="chald" data-i18n="sysC2">Chaldean (Babil)</option>
          </select>
        </div>
      </div>
      <div class="btns"><button id="calc2"><span data-i18n="calc2Btn">Uyumluluğu Hesapla</span></button></div>

      <div class="card"><h3 data-i18n="compSumTitle">Özet</h3><div class="long muted" id="comp-summary">—</div></div>
      <div class="two"><div class="card"><h3 data-i18n="compLifeTitle">Temel Uyum (Yaşam Yolu)</h3><div class="long" id="comp-life"></div></div></div>
    </div>

    <!-- BİLGİ -->
    <div class="panel" id="panel-bilgi" role="tabpanel">
      <div class="card">
        <h3 data-i18n="howTitle">Bu Araç Nasıl Çalışır?</h3>
        <p class="long" id="howBody" data-i18n-html="howBody"></p>
      </div>
      <div class="two">
        <div class="card">
          <h3 data-i18n="termsTitle">Terimler &amp; Hesaplama</h3>
          <details open><summary data-i18n="termLife">Yaşam Yolu</summary><div class="muted" data-i18n="termLifeBody"></div></details>
          <details><summary data-i18n="termDay">Doğum Günü</summary><div class="muted" data-i18n="termDayBody"></div></details>
          <details><summary data-i18n="termExpr">İfade</summary><div class="muted" data-i18n="termExprBody"></div></details>
          <details><summary data-i18n="termSoul">Ruh Dürtüsü</summary><div class="muted" data-i18n="termSoulBody"></div></details>
          <details><summary data-i18n="termPers">Kişilik</summary><div class="muted" data-i18n="termPersBody"></div></details>
          <details><summary data-i18n="termMaturity">Olgunluk</summary><div class="muted" data-i18n="termMaturityBody"></div></details>
          <details><summary data-i18n="termLessons">Karmik Dersler</summary><div class="muted" data-i18n="termLessonsBody"></div></details>
          <details><summary data-i18n="termDebts">Karmik Borçlar</summary><div class="muted" data-i18n="termDebtsBody"></div></details>
          <details><summary data-i18n="termPassion">Gizli Tutku</summary><div class="muted" data-i18n="termPassionBody"></div></details>
          <details><summary data-i18n="termBalance">Denge</summary><div class="muted" data-i18n="termBalanceBody"></div></details>
          <details><summary data-i18n="termPY">Kişisel Yıl/Ay/Gün</summary><div class="muted" data-i18n="termPYBody"></div></details>
        </div>
        <div class="card"><h3 data-i18n="quickGuideTitle">Hızlı Anlam Rehberi</h3><p id="quickPills"></p></div>
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const $  = (s)=>document.querySelector(s);
  const $$ = (s)=>document.querySelectorAll(s);

  /* =================== I18N =================== */
  const I18N = {
    tr:{
      title:"Tabirly • Numeroloji Falı", langLabel:"Dil",
      tagline:"Pythagoras ↔ Chaldean, Akıllı Özet, Uyumluluk, Timeline. Tüm hesaplamalar tarayıcıda. Hiçbir bilginiz bize iletilmez.",
      note:"Yoğun görünebilir; her şeyi açıkça yazdım. Aklına takılanı sor.",
      tabSingle:"Tek Kişi", tabCompat:"Uyumluluk (2 Kişi)", tabInfo:"Bilgi",
      nameLbl:"Tam İsim (resmi)", dobLbl:"Doğum Tarihi", refLbl:"Kişisel Yıl/Ay/Gün Referans Tarihi",
      sysLbl:"Sistem", sysP:"Pythagoras (Modern)", sysC:"Chaldean (Babil)",
      calcBtn:"Hesapla", copyBtn:"Kopyala", printBtn:"Yazdır / PDF",
      chald9:"Chaldean’da 9 rakamı harf eşleşmesinde yoktur; sadece toplamdan doğarsa görünür.",
      smartTitle:"Akıllı Özet", smartDefault:"Sonuçları hesapla; kişisel özet burada oluşacak.",
      coreTitle:"Çekirdek Sayılar", supportTitle:"Destekleyici Sayılar", cyclesTitle:"Zaman Döngüleri",
      timelineTitle:"Zirve ve Mücadele Dönemleri (Pinnacle & Challenge Timeline)",
      longTextsTitle:"Uzun Yorumlar (Sayıya Özgü)", chaldHint:"Chaldean seçiliyken her kartın altında “Chaldean Farkı” görünür.",
      aNameLbl:"İsim A", aDobLbl:"Doğum A", bNameLbl:"İsim B", bDobLbl:"Doğum B",
      sysLbl2:"Sistem", sysP2:"Pythagoras (Modern)", sysC2:"Chaldean (Babil)", calc2Btn:"Uyumluluğu Hesapla",
      compSumTitle:"Özet", compLifeTitle:"Temel Uyum (Yaşam Yolu)",
      howTitle:"Bu Araç Nasıl Çalışır?",
      howBody:`<b>Pythagoras</b>: Harfler 1–9’a eşit dağılır (TR normalizasyonu: ç→c, ğ→g, ı/İ→i, ö→o, ş→s, ü→u).<br>
<b>Chaldean</b>: A,I,J,Q,Y→1; B,K,R→2; C,G,L,S→3; D,M,T→4; E,H,N,X→5; U,V,W→6; O,Z→7; F,P→8. <u>9 harf eşleşmesinde yok</u>.<br>
Doğum tarihinden Yaşam Yolu & Doğum Günü; isimden İfade, Ruh Dürtüsü, Kişilik, Gizli Tutku, Denge çıkar. Karmik Dersler: isimde temsil edilmeyen enerjiler; Karmik Borçlar: 13/14/16/19. Kişisel Yıl/Ay/Gün seçtiğin tarih ritmine göre hesaplanır.`,
      termsTitle:"Terimler & Hesaplama",
      termLife:"Yaşam Yolu", termLifeBody:"Doğumdaki tüm rakamlar toplanır; 11/22/33 korunur.",
      termDay:"Doğum Günü", termDayBody:"Ayın günü; 11/22 korunabilir.",
      termExpr:"İfade", termExprBody:"İsimdeki tüm harflerin toplamı.",
      termSoul:"Ruh Dürtüsü", termSoulBody:"Sadece sesli harflerin toplamı.",
      termPers:"Kişilik", termPersBody:"Sadece sessiz harflerin toplamı.",
      termMaturity:"Olgunluk", termMaturityBody:"Yaşam Yolu + İfade.",
      termLessons:"Karmik Dersler", termLessonsBody:"İsimde hiç temsil edilmeyen enerjiler (Chaldean’da 9 eksik sayılmaz).",
      termDebts:"Karmik Borçlar", termDebtsBody:"13/14/16/19 görüldüğünde zorlu ders sinyali.",
      termPassion:"Gizli Tutku", termPassionBody:"En sık tekrar eden harf(ler) → sayı(lar).",
      termBalance:"Denge", termBalanceBody:"Her adın ilk harfi → kriz tepkisi.",
      termPY:"Kişisel Yıl/Ay/Gün", termPYBody:"Doğum ay+gün + referans yılı; ay/gün benzer mantık.",
      quickGuideTitle:"Hızlı Anlam Rehberi",
      namePH:"Örn: Metehan Kuzu", nameAPH:"Kişi A", nameBPH:"Kişi B",
      dobHint:"Biçim: gg/aa/yyyy", refHint:"Biçim: gg/aa/yyyy", aDobHint:"Biçim: gg/aa/yyyy", bDobHint:"Biçim: gg/aa/yyyy",

      /* UI feedback */
      needBoth:"İsim ve doğum tarihi zorunlu.",
      enterFirst:"İsim ve doğum tarihi gir, sonra Hesapla.",
      lessonsT:"Karmik Dersler", lessonsB:"Eksik enerji",
      lessonsLong:"Bu alanlar bilinçli pratikle güçlenir.",
      debtT:"Karmik Borç", debtNoneMini:"Borç yok", debtYesMini:"Borç görünüyor",
      debtNoneLong:"Karmik borç sayısı bulunmadı.", debtYesLong:"Karmik borç sayıları: ",
      hiddenT:"Gizli Tutku", hiddenBadge:"Baskın harf(ler)",
      hiddenNone:"Gizli Tutku saptanamadı (isim verisi yetersiz).",
      hiddenLong:"Baskın titreşimler doğal yönelim oluşturur; bilinçli kullanırsan ivme sağlar.",
      balanceT:"Denge (Balance)", balanceBadge:"Kriz modu",
      balanceNoneMini:"Üretilemedi.", balanceNoneLong:"İsim yoluyla hesaplanır; ad-soyad girişini kontrol et.",
      balanceLong:"Gerilimde bu strateji işe yarar; abartısına kaçma.",
      year:"Kişisel Yıl", month:"Kişisel Ay", day:"Kişisel Gün",
      theme:"Tema: ", tone:"Ton: ", ground:"Aylara ve günlere zemin olur.", alignM:"Aylık planları bu tona göre ayarla.", alignD:"Bugün tek adımlık işler için bu enerjiyi kullan.",
      checkDates:"Ref. tarih ve doğum tarihini kontrol et.", computePY:"Önce Kişisel Yıl hesaplanır.", computePM:"Önce Kişisel Ay hesaplanır.",
      invalidDate:"Geçersiz tarih.", pin:"Zirve", chal:"Mücadele",
      pinLegend:"Zirve = dönemin ana teması • Mücadele = dönemin sınavı.",
      copyOK:"Kopyalandı!"
    },
    en:{
      title:"Tabirly • Numerology Reading", langLabel:"Language",
      tagline:"Pythagoras ↔ Chaldean, Smart Summary, Compatibility, Timeline. All calculations run in your browser. Nothing is sent to us.",
      note:"It may look dense; everything is explained. Ask anything.",
      tabSingle:"Single", tabCompat:"Compatibility (2)", tabInfo:"Info",
      nameLbl:"Full Name (legal)", dobLbl:"Date of Birth", refLbl:"Reference Date for Personal Year/Month/Day",
      sysLbl:"System", sysP:"Pythagoras (Modern)", sysC:"Chaldean (Babylon)",
      calcBtn:"Calculate", copyBtn:"Copy", printBtn:"Print / PDF",
      chald9:"In Chaldean, number 9 is not assigned to letters; it appears only if it emerges from totals.",
      smartTitle:"Smart Summary", smartDefault:"Calculate to generate your personal summary here.",
      coreTitle:"Core Numbers", supportTitle:"Supporting Numbers", cyclesTitle:"Time Cycles",
      timelineTitle:"Pinnacle & Challenge Timeline",
      longTextsTitle:"Long Interpretations (By Number)", chaldHint:"When Chaldean is selected, “Chaldean Difference” appears under each card.",
      aNameLbl:"Name A", aDobLbl:"Birth A", bNameLbl:"Name B", bDobLbl:"Birth B",
      sysLbl2:"System", sysP2:"Pythagoras (Modern)", sysC2:"Chaldean (Babylon)", calc2Btn:"Calculate Compatibility",
      compSumTitle:"Summary", compLifeTitle:"Core Compatibility (Life Path)",
      howTitle:"How does this tool work?",
      howBody:`<b>Pythagoras</b>: Letters map evenly to 1–9 (TR normalization: ç→c, ğ→g, ı/İ→i, ö→o, ş→s, ü→u).<br>
<b>Chaldean</b>: A,I,J,Q,Y→1; B,K,R→2; C,G,L,S→3; D,M,T→4; E,H,N,X→5; U,V,W→6; O,Z→7; F,P→8. <u>9 is not mapped to letters</u>.<br>
From birth date: Life Path & Birthday; from the name: Expression, Soul Urge, Personality, Hidden Passion, Balance. Karmic Lessons = energies not represented; Karmic Debts = 13/14/16/19. Personal Year/Month/Day follows your selected reference date.`,
      termsTitle:"Terms & Calculations",
      termLife:"Life Path", termLifeBody:"Sum all digits in the birth date; keep 11/22/33.",
      termDay:"Birthday", termDayBody:"Day of month; 11/22 may be kept.",
      termExpr:"Expression", termExprBody:"Sum of all letters in the full name.",
      termSoul:"Soul Urge", termSoulBody:"Sum of vowels only.",
      termPers:"Personality", termPersBody:"Sum of consonants only.",
      termMaturity:"Maturity", termMaturityBody:"Life Path + Expression.",
      termLessons:"Karmic Lessons", termLessonsBody:"Energies not present in the name (9 is not considered missing in Chaldean).",
      termDebts:"Karmic Debts", termDebtsBody:"Seeing 13/14/16/19 signals a tough pattern.",
      termPassion:"Hidden Passion", termPassionBody:"Most frequent letter(s) → number(s).",
      termBalance:"Balance", termBalanceBody:"First letter of each name → crisis response.",
      termPY:"Personal Year/Month/Day", termPYBody:"Birth month+day + reference year; month/day similarly.",
      quickGuideTitle:"Quick Meaning Guide",
      namePH:"e.g., John Smith", nameAPH:"Person A", nameBPH:"Person B",
      dobHint:"Format: mm/dd/yyyy", refHint:"Format: mm/dd/yyyy", aDobHint:"Format: mm/dd/yyyy", bDobHint:"Format: mm/dd/yyyy",

      needBoth:"Full name and date of birth are required.",
      enterFirst:"Enter full name and date of birth, then press Calculate.",
      lessonsT:"Karmic Lessons", lessonsB:"Missing energy",
      lessonsLong:"These areas strengthen with conscious practice.",
      debtT:"Karmic Debt", debtNoneMini:"No debt", debtYesMini:"Debt detected",
      debtNoneLong:"No karmic debt number detected.", debtYesLong:"Karmic debt numbers: ",
      hiddenT:"Hidden Passion", hiddenBadge:"Dominant letter(s)",
      hiddenNone:"Hidden Passion not detected.",
      hiddenLong:"Dominant vibrations shape natural drive; used consciously, they give momentum.",
      balanceT:"Balance", balanceBadge:"Crisis mode",
      balanceNoneMini:"Not available.", balanceNoneLong:"Computed from name; check your full name entry.", balanceLong:"In stress this strategy helps; avoid excess.",
      year:"Personal Year", month:"Personal Month", day:"Personal Day",
      theme:"Theme: ", tone:"Tone: ", ground:"It sets the tone for months/days.", alignM:"Align monthly plans with this tone.", alignD:"Use this energy for single-step tasks today.",
      checkDates:"Check reference date and birth date.", computePY:"Compute Personal Year first.", computePM:"Compute Personal Month first.",
      invalidDate:"Invalid date.", pin:"Pinnacle", chal:"Challenge",
      pinLegend:"Pinnacle = main theme • Challenge = the period’s test.",
      copyOK:"Copied!"
    }
  };

  function applyI18N(lang){
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k=el.getAttribute('data-i18n'); if(k in I18N[lang]) el.textContent=I18N[lang][k];
    });
    document.querySelectorAll('[data-i18n-html]').forEach(el=>{
      const k=el.getAttribute('data-i18n-html'); if(k in I18N[lang]) el.innerHTML=I18N[lang][k];
    });
    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const k=el.getAttribute('data-i18n-ph'); if(k in I18N[lang]) el.placeholder=I18N[lang][k];
    });
    // Pills (quick guide)
    const pills=(lang==='tr'
      ? ["1: Liderlik","2: Uyum","3: İfade","4: Düzen","5: Özgürlük","6: Sorumluluk","7: Bilgelik","8: Güç","9: Hizmet","11: İlham","22: İnşa","33: Şifa"]
      : ["1: Leadership","2: Harmony","3: Expression","4: Order","5: Freedom","6: Responsibility","7: Wisdom","8: Power","9: Service","11: Inspiration","22: Building","33: Healing"]);
    $('#quickPills').innerHTML=pills.map(x=>`<span class="pill">${x}</span>`).join('');
    // date input locale hint
    document.querySelectorAll('input[type="date"]').forEach(d=>d.setAttribute('lang',lang));
  }

  /* =================== Engine =================== */
  const MAP_PYTH={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,j:1,k:2,l:3,m:4,n:5,o:6,p:7,q:8,r:9,s:1,t:2,u:3,v:4,w:5,x:6,y:7,z:8};
  const MAP_CHALD={a:1,i:1,j:1,q:1,y:1,b:2,k:2,r:2,c:3,g:3,l:3,s:3,d:4,m:4,t:4,e:5,h:5,n:5,x:5,u:6,v:6,w:6,o:7,z:7,f:8,p:8};
  const isMaster = n => [11,22,33].includes(n);
  const sumDigits = n => String(n).split('').reduce((a,b)=>a+Number(b),0);
  const reduceNum = n => { let x=n; while(x>9 && !isMaster(x)) x=sumDigits(x); return x; };
  const trNorm = s => s?.toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/ç/g,'c').replace(/ğ/g,'g').replace(/[ıiİ]/g,'i')
    .replace(/ö/g,'o').replace(/ş/g,'s').replace(/ü/g,'u')
    .replace(/[^a-z\s]/g,'') || "";
  const onlyV = s => s.replace(/[^aeiouy]/g,'');
  const onlyC = s => s.replace(/[aeiouy]/g,'');

  const today=new Date(); const iso=d=>d.toISOString().slice(0,10); $('#refdate').value=iso(today);

  function lettersToSum(letters, sys){ const map=sys==="chald"?MAP_CHALD:MAP_PYTH; let tot=0; for(const ch of letters){ tot+=(map[ch]||0); } return tot; }
  function dateParts(yyyy_mm_dd){ if(!yyyy_mm_dd) return {}; const [Y,M,D]= yyyy_mm_dd.split("-").map(Number); return {Y,M,D}; }
  function karmicLessons(letters, sys){
    const map=sys==="chald"?MAP_CHALD:MAP_PYTH;
    const present=new Set([...letters].map(ch=>map[ch]).filter(Boolean));
    const missing=[]; for(let i=1;i<=9;i++){ if(sys==="chald"&&i===9) continue; if(!present.has(i)) missing.push(i); }
    return missing;
  }
  function hiddenPassion(letters, sys){
    if(!letters) return {nums:[],letters:[]};
    const map=sys==="chald"?MAP_CHALD:MAP_PYTH;
    const freq={}; for(const ch of letters){ freq[ch]=(freq[ch]||0)+1; }
    const max=Math.max(...Object.values(freq));
    const lettersTop=Object.keys(freq).filter(k=>freq[k]===max);
    const nums=Array.from(new Set(lettersTop.map(l=>map[l]).filter(Boolean))).sort((a,b)=>a-b);
    return {nums,letters:lettersTop};
  }
  function balanceNumber(nameNorm, sys){
    const map=sys==="chald"?MAP_CHALD:MAP_PYTH;
    const firsts=nameNorm.trim().split(/\s+/).map(w=>w[0]).filter(Boolean);
    if(firsts.length===0) return null;
    const total=firsts.reduce((a,ch)=>a+(map[ch]||0),0);
    return reduceNum(total);
  }
  function personalYear(dob, ref){ const {M:bm,D:bd}=dateParts(dob); const {Y:ry}=dateParts(ref); if(!bm||!bd||!ry) return null; const total=sumDigits(bm)+sumDigits(bd)+sumDigits(ry); return reduceNum(total); }
  function personalMonth(py, ref){ const {M}=dateParts(ref); if(!py||!M) return null; return reduceNum(py + sumDigits(M)); }
  function personalDay(pm, ref){ const {D}=dateParts(ref); if(!pm||!D) return null; return reduceNum(pm + sumDigits(D)); }
  function detectDebts({lifeRaw,exprRaw,day}){ const set=new Set(); [lifeRaw,exprRaw,day].forEach(v=>{ if([13,14,16,19].includes(v)) set.add(v); }); return Array.from(set).sort((a,b)=>a-b); }
  function pinnaclesAndChallenges(dob){
    const {Y,M,D}=dateParts(dob); if(!Y||!M||!D) return null;
    const r=n=>reduceNum(n);
    const rm=r(sumDigits(M)), rd=r(sumDigits(D)), ry=r(sumDigits(Y));
    const P1=r(rm+rd), P2=r(rd+ry), P3=r(P1+P2), P4=r(rm+ry);
    const C1=r(Math.abs(rd-rm)), C2=r(Math.abs(rd-ry)), C3=r(Math.abs(C1-C2)), C4=r(Math.abs(rm-ry));
    return {spans:[{label:"0–36",P:P1,C:C1},{label:"37–45",P:P2,C:C2},{label:"46–54",P:P3,C:C3},{label:"55+",P:P4,C:C4}]};
  }

  const Lang = { cur:'tr', set(l){ this.cur=l; document.documentElement.setAttribute('lang',l); applyI18N(l); } };

  /* Smart Summary tone FIX: include 11/22/33 */
  function smartSummary({life,expr,soul,pers,bday,matt,py}){
    const L = Lang.cur==='tr'
      ? {lp:"Yaşam Yolu",ex:"İfade",su:"Ruh Dürtüsü",pe:"Kişilik",bd:"Doğum Günü",ma:"Olgunluk",yr:"Bu yıl (Kişisel Yıl "}
      : {lp:"Life Path",ex:"Expression",su:"Soul Urge",pe:"Personality",bd:"Birthday",ma:"Maturity",yr:"This year (Personal Year "};
    const tone = Lang.cur==='tr'
      ? {1:"liderlik, yeni başlangıçlar",2:"uyum, işbirliği, sabır",3:"ifade, yaratıcılık, görünürlük",4:"düzen, emek, yapı kurma",5:"değişim, özgürlük, keşif",6:"sorumluluk, bakım, kalite",7:"analiz, içgörü, maneviyat",8:"güç, sonuç, yönetim",9:"tamamlama, şefkat, hizmet",11:"ilham, vizyon",22:"büyük inşa, strateji",33:"şifa, öğreticilik"}
      : {1:"leadership, fresh starts",2:"harmony, cooperation, patience",3:"expression, creativity, visibility",4:"structure, work, building",5:"change, freedom, exploration",6:"responsibility, care, quality",7:"analysis, insight, spirituality",8:"power, results, management",9:"completion, compassion, service",11:"inspiration, vision",22:"master building, strategy",33:"healing, teaching"};
    const yearTxt = Lang.cur==='tr'
      ? {1:"Yeni başlangıçlar",2:"İşbirliği",3:"İfade",4:"Düzen",5:"Değişim",6:"Sorumluluk",7:"İçe dönüş",8:"Güç",9:"Tamamlama"}
      : {1:"New beginnings",2:"Cooperation",3:"Expression",4:"Structure",5:"Change",6:"Responsibility",7:"Introspection",8:"Power",9:"Closure"};
    const lines=[];
    if(life) lines.push(`${L.lp} ${life}: ${tone[life]}.`);
    if(expr) lines.push(`${L.ex} ${expr}: ${tone[expr]}.`);
    if(soul && soul!==expr) lines.push(`${L.su} ${soul}: ${tone[soul]}.`);
    if(pers) lines.push(`${L.pe} ${pers}: ${tone[pers]}.`);
    if(bday) lines.push(`${L.bd} ${bday}: ${tone[bday]}.`);
    if(matt) lines.push(`${L.ma} ${matt}: ${tone[matt]}.`);
    if(py) lines.push(`${L.yr}${py}): ${yearTxt[py]}.`);
    return lines.join(" ");
  }

  /* Uzun yorumlar — TR tam, EN detaylı */
  const LONG = {
    tr:{
"1":"1 sayısı bağımsızlık, başlangıç ve öncülük enerjisidir. Bu titreşimi taşıyan kişi doğal olarak inisiyatif alma, risk görüp karar verme ve yeni yollar açma eğilimindedir. İşte veya kişisel projelerde sahiplenme duygusu yüksektir; bir fırsat doğduğunda beklemek yerine harekete geçer. Çocukluk ya da gençlik yıllarında “kendi başıma yapmalıyım” teması sık görülür; bu kimi zaman yalnızlık hissi yaratabilir. 1’in ışığı cesaret ve ilhamdır: çevresine “yapılabilir” duygusu aşılar. Gölgesi kibir, acelecilik ve başkalarının fikirlerine kapanmadır. Sağlıklı 1, liderliği tek başınalıkla karıştırmaz; yetki devreder, dinler ve fikir toplar. Günlük hayatta 1 titreşimini dengelemek için sporla enerjiyi boşaltmak, kısa hedef listeleriyle odağı netleştirmek ve “geri bildirim saati” gibi küçük ritüeller kurmak faydalıdır. 1, vizyonu gerçekle buluşturduğunda motor güç olur; aksadığında ise “ben yaparım” inadı ilişkilere zarar verebilir.",
"2":"2 sayısı uyum, işbirliği ve diplomasi titreşimidir. Bu enerjiye sahip olan kişi arabuluculuk, köprü kurma ve duygusal zekâyla karmaşayı yumuşatma becerisine sahiptir. İnsanların ne hissettiğini hızlıca sezebilir; ekiplerin içinde güven veren yapıştırıcı rolü oynar. Işığı empati, sabır ve rafine zarafettir. Gölgesi kararsızlık, çekingenlik ve aşırı onay arayışıdır; bazen kendi ihtiyaçlarını erteleyebilir. 2 titreşimi güçlü olan biri için “sınır belirleme” sanatı hayat boyu önemli bir derstir. Günlük örnek: yoğun bir toplantıda tansiyon yükseldiğinde, 2 enerjisi doğru kelimeleri seçip ortamı sakinleştirir; fakat bunu yaparken kendi görüşünü söylemeyi de unutmamalıdır. İlişkilerde sadakat ve duyarlılık yüksektir; küçük jestler, özenli iletişim ve ritim duygusu mutluluğu artırır. Meditasyon, nefes ve yavaş sporlar bu sayıyı dengeler. 2’nin olgun hali, yumuşak gücüyle büyük değişimleri mümkün kılar.",
"3":"3 sayısı ifade, yaratıcılık ve neşe akışıdır. Kelimeler, ses, renk ve ritim 3’ün doğal alanıdır; yazmak, konuşmak, sahne almak, görsel üretmek bu titreşimle kolaylaşır. Işığı esin ve sosyalliktir; bir toplantıyı canlandırır, zor konuyu hikâyeye dönüştürür. Gölgesi yüzeysellik, dağınıklık ve ertelemedir; espriyle konuyu dağıtma eğilimi görülebilir. 3, disiplinle birleştiğinde üretken bir sanatçıya, etkileyici bir öğretmene ya da topluluk önünde güvenle konuşan bir lidere dönüşür. Günlük hayatta içerik üretim blokları (ör. 25 dakikalık odak), küçük yayın takvimleri ve “taslak bırak, dön” kuralı 3’ün verimini artırır. İlişkilerde oyuncu ve sıcak bir enerji getirir; ancak duyguları hafife alma riski taşır. Duygusal açıklık egzersizleri, 3’ün samimiyetini derinleştirir. 3, neşeyi stratejiyle birleştirdiğinde, çevresine bulaşan bir momentum yaratır.",
"4":"4 sayısı emek, düzen ve yapı kurmadır. Sabırla adım adım ilerlemek, sistem kurmak ve sürdürülebilir sonuç üretmek 4’ün uzmanlığıdır. Işığı güvenilirlik ve dayanıklılıktır; zorlu projeleri sırtlar, süreçleri netleştirir. Gölgesi katılık, esneksizlik ve ayrıntıya takılıp büyük resmi kaçırmaktır. 4’ün gelişimi için “plan + esneklik” bileşimi kritik: takvim blokları ve kontrol listeleri iyi, fakat beklenmeyen fırsata yer açan pay da şart. Örnek: finans, hukuk, inşaat, veri operasyonu gibi alanlarda 4 enerjisi parıldar. İlişkilerde sorumluluk duygusu yüksektir; güven temelli bir bağ arar. Bedenlenmiş disiplin (düzenli uyku, yürüyüş) enerji kalitesini yükseltir. 4, hayalleri zemine çiviler; fakat zaman zaman yaratıcı molalar almazsa tükenmeye yaklaşabilir. Ritmik çalış, küçük kazanımları kutla, “niçin”ini görünür tut: 4 böylece sağlam köprüler kurar.",
"5":"5 sayısı özgürlük, değişim ve keşiftir. Merak, hareket ve deneyim odaklı öğrenme 5’in doğasıdır. Işığı esneklik, cesaret ve adaptasyondur; yeni şehirler, yeni beceriler, çok yönlü kariyerler bu titreşimle uyumludur. Gölgesi sabırsızlık, yüzeysellik ve taahhüt korkusudur; “hep bir şey kaçırıyorum” duygusu da görülebilir. 5 enerjisi, mikro disiplinle devleşir: 90 dakikalık derin çalışma, sonra keşif; 30 gün minik alışkanlık; “bir gir, bir derinleştir” kuralı. İlişkilerde alan ihtiyacı belirgindir; açık iletişim ve sınırlar özgürlükle bağlılığı dengeleyebilir. Seyahat, dil öğrenme, sahada satış/araştırma, medya üretimi 5’e uyar. 5, hareketi anlamla buluşturduğunda, değişimi yöneten bir kaşife dönüşür; aksi halde dağılma hissi artar. Seçici ol, az şeyi derin yap, kalanı deneyim alanına bırak.",
"6":"6 sayısı sevgi, bakım ve sorumluluk frekansıdır. Aile, ekip ve topluluk bağlarını onarma eğilimi vardır; estetik ve mekân iyileştirme (dekorasyon, ses, ışık) de 6’nın alanına girer. Işığı şefkat, sahiplenme ve hizmettir. Gölgesi aşırı yüklenme, kontrolcülük ve “herkesi kurtarma” şemasıdır. 6’nın sağlıklı hali, önce oksijen maskesini kendine takar: öz bakım, sınır ve delege. Meslekte eğitim, sağlık, danışmanlık, tasarım ve toplum hizmetleri öne çıkar. İlişkilerde derin bağlılık sunar; küçük ritüeller (ortak akşam, ekran-sız sohbet) güveni büyütür. 6, kalite ve sıcaklık kattığında çevresinde sığınak hissi yaratır; fakat kendi ihtiyaçlarını yok sayarsa kırgınlık birikir. Denge: “evet” kadar “hayır” deme pratiği, haftalık bakım randevuları ve minik güzelleştirmeler.",
"7":"7 sayısı içgörü, analiz ve manevi derinliktir. Yüzeysel cevaplar tatmin etmez; veri, teori ve sezgi birlikte çalışır. Işığı bilgelik ve özgün içgörüdür; bilim, felsefe, ar-ge, veri analitiği, psikoloji ve ruhsal çalışmalar 7’ye uygundur. Gölgesi izolasyon, kuşku ve eleştirelliğin sertleşmesidir. 7 için “yalnızlık + topluluk” dengesi altındır: derin çalışma blokları, ardından kısa paylaşım. Duyguları zihne tercüme etmek yerine, bedensel farkındalık (yürüyüş, nefes) denge sağlar. İlişkilerde seçicidir; az ama derin bağ ister. 7’nin olgun hali, hakikati ararken alçakgönüllüdür: bilmediğini kabul eder, araştırır, sentezler ve paylaşır. Böylece kuru teoriden çıkıp dönüştürücü bir rehbere evrilir.",
"8":"8 sayısı güç, yönetim ve maddi ustalıktır. Kaynak toplama, sistem kurma ve sonuç üretme 8’in uzmanlığıdır. Işığı vizyon ve icradır; girişimcilik, finans, operasyon ve liderlik rollerinde parlar. Gölgesi kontrol takıntısı, aşırı rekabet ve duygulardan kopuştur. 8, değer üretirken etik ve uzun vadeyi odağa aldığında kalıcı etki yaratır. Parayla sağlıklı ilişki (bütçe, yatırım, hayır) gücü rafine eder. İlişkilerde saygı ve netlik arar; duygu dilini öğrenmek 8’i yumuşatır. Beden pratiği ve sınırları net takvimler, “hayat tasarımı”na güç katar. 8, vizyonu toplumsal faydayla buluşturduğunda gerçek zafer gelir.",
"9":"9 sayısı idealizm, şefkat ve tamamlanmadır. Evrensel değerlere yönelme, öğretme ve sanatla iyileştirme 9’un doğasında vardır. Işığı cömertlik ve bilgeliktir; gölgesi hayal kırıklığı ve tükenmiş fedakârlıktır. 9’un dersi: sınırları olan merhamet. İleri yaşlarda paylaşım ve hizmet teması güçlenir; mentorluk, sosyal etki projeleri, sanatla topluma seslenmek tatmin verir. Günlük yaşamda “küçük vedalar” (fazlalığı bırakmak) 9’un hafiflemesine yardım eder. Tamamlanma döngülerinde yas ve şükran birlikte tutulduğunda 9, yeniye yer açar.",
"11":"11 sezgi, ilham ve vizyonun ustalığıdır. 2’nin uyumunu taşırken üst frekansta bir farkındalık ekler. Erken yaşlardan itibaren başkalarının göremediğini hissetme, eşzamanlılıkları fark etme ve sanatsal/ruhsal ifade görülebilir. Işığı başkalarına yol gösteren ilhamdır; gölgesi aşırı hassasiyet, kaygı ve amaç baskısıdır. 11, enerjisini bedene indirip disipline ettiğinde öğretmen/rehber olur: ilhamı somut üretime çevirir (eser, program, hareket). Ritüel, meditasyon ve topraklayıcı rutinler denge sağlar. 11’in hediyesi, kolektif sezgiyi kelimeye ve esere dönüştürmesidir.",
"22":"22 “Usta İnşacı”dır. 4’ün düzenine dev vizyon ekler; hayali gerçeğe çiviler. Topluma fayda sağlayan kalıcı yapılar kurma eğilimi yüksektir (vakıf, kampüs, şehir ölçekte projeler). Işığı: vizyonu somutlaştırmak. Gölgesi: sorumluluk baskısı, katılık veya vizyon karşısında geri çekilmek. 22, strateji + takım + zaman ufkuyla çalıştığında tarihe iz bırakır. Kişisel bakım ve delege, bu titreşimin yan etkilerini (aşırı yük) dengeler.",
"33":"33 “Usta Öğretmen/Şifacı”dır. 6’nın şefkatini yüksek bilince taşır; ilhamı somut bakım ve öğrenmeye dönüştürür. Öğretme, danışmanlık, sanatla şifa ve manevi rehberlik alanları 33’e uygundur. Işığı koşulsuz sevgi ve topluluk iyileştirmesidir; gölgesi kendini unutmak ve tükenmişliktir. 33, sınır ve öz bakım öğrenildiğinde, geniş kitlelere dokunan bir iyileştirici etki yaratır; sevgiyi yapı ve yöntemle sürdürülebilir kılar."
    },
    en:{
"1":"1 = independence and initiative. Light: courage to start and inspire; Shadow: arrogance and impatience. Balance by listening, delegating, and tight focus lists.",
"2":"2 = harmony, diplomacy, bridge-building. Light: empathy, patience; Shadow: indecision and weak boundaries. Practice saying no and set limits.",
"3":"3 = expression and creative flow. Light: story and humor; Shadow: scatter and procrastination. Pair creativity with short disciplined sprints.",
"4":"4 = structure and work. Light: reliability, stamina; Shadow: rigidity and missing the big picture. Keep plans but reserve slack for surprises.",
"5":"5 = freedom and change. Light: adaptability; Shadow: restlessness and FOMO. Use micro-disciplines and selective depth.",
"6":"6 = care, responsibility, quality. Light: devotion; Shadow: over-rescuing. Boundaries and self-care first, then service.",
"7":"7 = insight, analysis, spirituality. Light: wisdom; Shadow: isolation and overthinking. Alternate deep work with brief sharing.",
"8":"8 = power, management, results. Light: execution; Shadow: control and over-competition. Tie ambition to ethics and long-term value.",
"9":"9 = compassion, ideals, completion. Light: generosity; Shadow: exhausted sacrifice. Practice boundaried kindness and conscious closure.",
"11":"11 = inspiration and vision at a master level. Ground sensitivity via routine and embodiment; turn vision into artifacts.",
"22":"22 = master builder. Add team, timeline, and delegation to hold scale; build structures that last and serve.",
"33":"33 = master teacher/healer. Love with methods; teach and heal at scale while avoiding burnout through limits."
    }
  };

  const CHALD_DIFF = {
    tr:{ "1":"Liderlikte sabır/tevazu sınavı.", "2":"Sınır koyma dersi belirgin.", "3":"Söz karması uyarısı.", "4":"Kısıt ve gecikme sert çalışır.", "5":"Aşırılığa bedel; özdisiplin şart.", "6":"Hizmette öz bakım dersi.", "7":"Maneviyat/araştırma vurgulu.", "8":"Güç–bedel yasası sert işler.", "9":"Harflerden gelmediği için özel bir kapanış teması taşır.", "11":"İlham–topraklanma dengesi.", "22":"Sabır ve tevazu anahtar.", "33":"Ağır sorumlulukla şifa."},
    en:{ "1":"Leadership tested for patience/humility.", "2":"Lesson: boundaries.", "3":"Speech karma warning.", "4":"Restrictions/delays hit harder.", "5":"Excess costs; discipline needed.", "6":"Service with self-care.", "7":"Research/spirituality emphasized.", "8":"Power–price law is strict.", "9":"Special when arising from totals only.", "11":"Inspiration needs grounding.", "22":"Patience and humility are keys.", "33":"Healing with heavy duty."}
  };

  function card(title, num, hint, text, chaldNote){
    const extra = chaldNote ? `<div class="chald-note"><b>${Lang.cur==='tr'?'Chaldean Farkı':'Chaldean Difference'}:</b> ${chaldNote}</div>` : "";
    return `<div class="card"><div class="row-inline"><span class="k">${num ?? "—"}</span><h3>${title}</h3><span class="badge">${hint||""}</span></div><div class="long">${text||""}</div>${extra}</div>`;
  }

  function calcSingle(){
    const t=I18N[Lang.cur];
    const nameRaw=$('#name').value.trim();
    const dob=$('#dob').value.trim();
    const ref=$('#refdate').value.trim() || iso(today);
    const sys=$('#sys').value;
    $('#sys-badge').textContent = sys==="chald" ? "Chaldean" : "Pythagoras";

    const nameNorm=trNorm(nameRaw);
    const letters=nameNorm.replace(/\s+/g,'');
    const outCore=$('#core-grid'), outSup=$('#support-grid'), outCy=$('#cycle-grid'), outLong=$('#long-texts'); const timelineEl=$('#timeline');

    if(!letters || !dob){
      outCore.innerHTML = `<div class="card">${t.needBoth}</div>`;
      outSup.innerHTML=outCy.innerHTML=outLong.innerHTML=timelineEl.innerHTML="";
      $('#smart-summary').textContent = t.enterFirst; return;
    }

    const exprRaw=lettersToSum(letters,sys), expr=reduceNum(exprRaw);
    const soulLetters=onlyV(letters), consLetters=onlyC(letters);
    const soul=soulLetters ? reduceNum(lettersToSum(soulLetters,sys)) : 0;
    const pers=consLetters ? reduceNum(lettersToSum(consLetters,sys)) : 0;
    const {Y,M,D}=dateParts(dob);
    const lifeRaw=String(Y).split('').concat(String(M).split(''),String(D).split('')).map(Number).reduce((a,b)=>a+b,0);
    const life=reduceNum(lifeRaw);
    const bdayRaw=D||0; const bday=(bdayRaw===11||bdayRaw===22)?bdayRaw:reduceNum(bdayRaw||0);
    const matt=(life&&expr)?reduceNum(life+expr):null;

    const lessons=karmicLessons(letters,sys);
    const debts=detectDebts({lifeRaw,exprRaw,day:bdayRaw});
    const hp=hiddenPassion(letters,sys);
    const bal=balanceNumber(nameNorm,sys);

    const py=personalYear(dob,ref), pm=personalMonth(py,ref), pd=personalDay(pm,ref);

    $('#smart-summary').textContent = smartSummary({life,expr,soul,pers,bday,matt,py});

    const tL = Lang.cur==='tr'
      ? {life:"Yaşam Yolu",expr:"İfade (Expression)",soul:"Ruh Dürtüsü",pers:"Kişilik",bday:"Doğum Günü",matt:"Olgunluk",hintLife:"Kader teması",hintP:"Pythagoras yorumu",hintC:"Chaldean yorumu",gift:"Doğuştan armağan",m35:"35+ yönelimi"}
      : {life:"Life Path",expr:"Expression",soul:"Soul Urge",pers:"Personality",bday:"Birthday",matt:"Maturity",hintLife:"Fate theme",hintP:"Pythagoras view",hintC:"Chaldean view",gift:"Inborn gift",m35:"35+ orientation"};

    const chald = (n)=> sys==="chald" ? (CHALD_DIFF[Lang.cur][String(n)]||"") : "";

    outCore.innerHTML = [
      card(tL.life,life,tL.hintLife,   LONG[Lang.cur][String(life)]||"", chald(life)),
      card(tL.expr,expr,sys==="chald"?tL.hintC:tL.hintP, LONG[Lang.cur][String(expr)]||"", chald(expr)),
      card(tL.soul,soul,sys==="chald"?tL.hintC:tL.hintP, LONG[Lang.cur][String(soul)]||"", chald(soul)),
      card(tL.pers,pers,sys==="chald"?tL.hintC:tL.hintP, LONG[Lang.cur][String(pers)]||"", chald(pers)),
      card(tL.bday,bday,tL.gift,       LONG[Lang.cur][String(bday)]||"", chald(bday)),
      card(tL.matt,matt,tL.m35,        LONG[Lang.cur][String(matt)]||"", chald(matt))
    ].join("");

    const lesList=lessons.length?lessons.join(" / "):"—";
    const hpList=hp.nums.length?hp.nums.join(" / "):"—";
    const debtList=debts.length?debts.join(" / "):"—";

    outSup.innerHTML = [
      `<div class="card"><div class="row-inline"><span class="k">${lesList}</span><h3>${t.lessonsT}</h3><span class="badge">${t.lessonsB}</span></div><div class="mini">${lessons.length?(Lang.cur==='tr'?'Eksik enerjiler: ':'Missing energies: ')+lessons.join(", "):(Lang.cur==='tr'?'Eksik enerji görünmüyor.':'No missing energy appears.')}</div><div class="long">${t.lessonsLong}</div></div>`,
      `<div class="card"><div class="row-inline"><span class="k">${debtList}</span><h3>${t.debtT}</h3><span class="badge">13/14/16/19</span></div><div class="mini">${debts.length?t.debtYesMini:t.debtNoneMini}</div><div class="long">${debts.length? (t.debtYesLong+debts.join(", ")) : t.debtNoneLong }</div></div>`,
      `<div class="card"><div class="row-inline"><span class="k">${hpList}</span><h3>${t.hiddenT}</h3><span class="badge">${t.hiddenBadge}</span></div><div class="mini">${hp.nums.length? hp.nums.join(" • ")+(hp.letters.length?` &nbsp;|&nbsp; <span class="muted">${Lang.cur==='tr'?'Harf(ler)':'Letter(s)'}: ${hp.letters.join(", ").toUpperCase()}</span>`:"") : t.hiddenNone}</div><div class="long">${t.hiddenLong}</div></div>`,
      `<div class="card"><div class="row-inline"><span class="k">${bal ?? "—"}</span><h3>${t.balanceT}</h3><span class="badge">${t.balanceBadge}</span></div><div class="mini">${bal? bal : t.balanceNoneMini}</div><div class="long">${bal? t.balanceLong : t.balanceNoneLong}</div></div>`
    ].join("");

    const yearTxt = {tr:{1:"Yeni başlangıçlar, cesur adımlar.",2:"İşbirliği, sabır.",3:"İfade, yaratıcılık.",4:"Düzen ve temel.",5:"Değişim ve keşif.",6:"Sorumluluk ve kalite.",7:"İçe dönüş ve analiz.",8:"Güç ve sonuç.",9:"Tamamlama ve bırakış."},
                     en:{1:"New beginnings, bold steps.",2:"Cooperation and patience.",3:"Expression and creativity.",4:"Structure and foundations.",5:"Change and exploration.",6:"Responsibility and quality.",7:"Introspection and analysis.",8:"Power and results.",9:"Completion and release."}}[Lang.cur];

    outCy.innerHTML = [
      `<div class="card"><div class="row-inline"><span class="k">${py ?? "—"}</span><h3>${t.year}</h3><span class="badge">${ref||""}</span></div><div class="mini">${py ? (t.theme + (yearTxt[py]||"")) : "—"}</div><div class="long">${py ? t.ground : t.checkDates}</div></div>`,
      `<div class="card"><div class="row-inline"><span class="k">${pm ?? "—"}</span><h3>${t.month}</h3><span class="badge">${ref||""}</span></div><div class="mini">${pm ? (t.tone + (yearTxt[pm]||"")) : "—"}</div><div class="long">${pm ? t.alignM : t.computePY}</div></div>`,
      `<div class="card"><div class="row-inline"><span class="k">${pd ?? "—"}</span><h3>${t.day}</h3><span class="badge">${ref||""}</span></div><div class="mini">${pd ? (Lang.cur==='tr'?'Mikro akış.':'Micro flow.') : "—"}</div><div class="long">${pd ? t.alignD : t.computePM}</div></div>`
    ].join("");

    const pc=pinnaclesAndChallenges(dob);
    $('#timeline').innerHTML = pc ? (`<div class="timebar">`+ pc.spans.map(s=>`
      <div class="timeItem">
        <b>${s.label}</b>
        <div><span class="tip">${I18N[Lang.cur].pin}: ${s.P}</span> • <span class="tip">${I18N[Lang.cur].chal}: ${s.C}</span></div>
        <div class="mini"><b>${I18N[Lang.cur].pin} ${s.P}:</b> — &nbsp;|&nbsp; <b>${I18N[Lang.cur].chal} ${s.C}:</b> —</div>
      </div>`).join('') + `</div><div class="time-legend">${I18N[Lang.cur].pinLegend}</div>`) : (`<div class='muted'>${I18N[Lang.cur].invalidDate}</div>`);

    // Long texts per unique numbers
    const uniques = Array.from(new Set([life,expr,soul,pers,bday,matt].filter(Boolean)));
    $('#long-texts').innerHTML = uniques.map(n=> card((Lang.cur==='tr'?'Sayı ':'Number ')+n,n,(Lang.cur==='tr'?'Uzun yorum':'Long interpretation'),(LONG[Lang.cur][String(n)]||""), chald(n))).join("");
  }

  function lifeFromDOB(dob){ const {Y,M,D}=dateParts(dob); if(!Y||!M||!D) return null; const raw=String(Y).split('').concat(String(M).split(''),String(D).split('')).map(Number).reduce((a,b)=>a+b,0); return reduceNum(raw); }
  function numberFromName(name,sys,filter){
    const norm=trNorm(name).replace(/\s+/g,''); let s=norm; if(filter==='v') s=onlyV(norm); if(filter==='c') s=onlyC(norm);
    if(!s) return 0; return reduceNum(lettersToSum(s,sys));
  }
  function calcCompat(){
    const t=I18N[Lang.cur];
    const aName=$('#nameA').value.trim(), aDOB=$('#dobA').value.trim();
    const bName=$('#nameB').value.trim(), bDOB=$('#dobB').value.trim();
    const sys=$('#sys2').value;
    if(!aName||!aDOB||!bName||!bDOB){ $('#comp-summary').textContent = (Lang.cur==='tr'?'İki isim ve iki doğum tarihi gerekli.':'Two names and two dates are required.'); $('#comp-life').innerHTML=""; return; }
    const A={life:lifeFromDOB(aDOB),soul:numberFromName(aName,sys,'v'),pers:numberFromName(aName,sys,'c')};
    const B={life:lifeFromDOB(bDOB),soul:numberFromName(bName,sys,'v'),pers:numberFromName(bName,sys,'c')};
    const pair=(x,y)=> (A.life===x&&B.life===y)||(A.life===y&&B.life===x);
    let summary=Lang.cur==='tr'?'Temel uyum dengeli görünüyor.':'Overall compatibility looks balanced.';
    if(pair(1,8)) summary=Lang.cur==='tr'?'1–8 güçlü liderlik sinerjisi; çözüm: paylaşımcı liderlik.':'1–8 strong leadership; solution: shared leadership.';
    if(pair(4,5)) summary=Lang.cur==='tr'?'4–5 yapı–özgürlük dengesi; çözüm: net sınırlar.':'4–5 structure–freedom; solution: clear boundaries.';
    if(pair(2,6)) summary=Lang.cur==='tr'?'2–6 yüksek uyum/bakım; çözüm: sınırlar ve öz bakım.':'2–6 high harmony/care; solution: boundaries & self-care.';
    $('#comp-summary').textContent=summary;

    const cards=[];
    if(A.life && B.life){
      const block = Lang.cur==='tr'? `Senin yaşam yolun <b>${A.life}</b>, onunki <b>${B.life}</b>. Farklı temalar doğru yönetilirse tamamlayıcı olur.` :
                                      `Your Life Path is <b>${A.life}</b>, theirs <b>${B.life}</b>. Differences complement if managed well.`;
      cards.push(`<div class="card"><h3>${Lang.cur==='tr'?'Yaşam Yolu Uyumları':'Life Path Compatibility'}</h3><div class="long">${block}</div></div>`);
    }
    if(A.soul && B.soul){
      const block = Lang.cur==='tr'? `Ruh Dürtüsü <b>${A.soul}</b> ↔ <b>${B.soul}</b>. Farklıysa ihtiyaçları anlamak kritik; benzerse akış kolay.` :
                                      `Soul Urge <b>${A.soul}</b> ↔ <b>${B.soul}</b>. If different, understand needs; if similar, flow is easy.`;
      cards.push(`<div class="card"><h3>${Lang.cur==='tr'?'Ruh Dürtüsü Uyumları':'Soul Urge Compatibility'}</h3><div class="long">${block}</div></div>`);
    }
    if(A.pers && B.pers){
      const block = Lang.cur==='tr'? `Kişilik <b>${A.pers}</b> ↔ <b>${B.pers}</b>. Kontrast çekici olabilir; yönetilmezse sürtüşme yaratır.` :
                                      `Personality <b>${A.pers}</b> ↔ <b>${B.pers}</b>. Contrast can attract yet rub if unmanaged.`;
      cards.push(`<div class="card"><h3>${Lang.cur==='tr'?'Kişilik (Dış İmaj) Uyumları':'Personality (Outer Image) Compatibility'}</h3><div class="long">${block}</div></div>`);
    }
    $('#comp-life').innerHTML = cards.join("");
  }

  // Tabs
  $$('.tab-btn').forEach(b=>{
    b.addEventListener('click', ()=>{
      $$('.tab-btn').forEach(x=>{x.classList.remove('active'); x.setAttribute('aria-selected','false');});
      b.classList.add('active'); b.setAttribute('aria-selected','true');
      const tab=b.dataset.tab; $$('.panel').forEach(p=>p.classList.remove('active')); const tgt=$('#panel-'+tab); if(tgt) tgt.classList.add('active');
    });
  });

  // Language switch
  $('#langSel').addEventListener('change', e=> Lang.set(e.target.value));

  // Buttons
  $('#calc').addEventListener('click', calcSingle);
  $('#print').addEventListener('click', ()=> window.print());
  $('#copy').addEventListener('click', ()=>{
    const nameRaw=$('#name').value.trim(); const dob=$('#dob').value.trim(); const ref=$('#refdate').value.trim(); const sys=$('#sys').value;
    const t=I18N[Lang.cur]; const out=[];
    out.push(`—— Tabirly • ${t.title} (${sys==="chald"?"Chaldean":"Pythagoras"})`);
    out.push(`${Lang.cur==='tr'?'İsim':'Name'}: ${nameRaw}`);
    out.push(`${Lang.cur==='tr'?'Doğum':'Birth'}: ${dob}`);
    const cg=$('#core-grid'); out.push(cg.textContent? (Lang.cur==='tr'?"Detaylar: yukarıdaki kartlarda.":"Details: see cards above.") : (Lang.cur==='tr'?"Önce Hesapla'ya bas.":"Press Calculate first."));
    out.push(`${Lang.cur==='tr'?'Kişisel Yıl/Ay/Gün Ref':'Personal Y/M/D Ref'}: ${ref||"—"}`);
    navigator.clipboard.writeText(out.join("\n")).then(()=>alert(t.copyOK));
  });
  $('#calc2').addEventListener('click', calcCompat);

  // Init
  Lang.set('tr'); // default TR
  applyI18N('tr'); // initial bind
});
</script>
